# Zero-Shot Learning for Reflection Removal of Single 360-Degree Image

# Abstract
従来の反射除去の手法は主にぼやけた弱い反射アーチファクトを除去することに重点を置いており、深刻で強い反射アーチファクトに対処できないことがよくある。  
しかし多くの場合、実際の反射現象は、人間でさえ透過シーンと反射シーンを完全に区別できないほど、鋭く激しい。  
本論文では360度画像を用いて、このような困難な反射アーチファクト除去を試みる。  
教師あり学習のためのペアデータ収集の負担や、異なるデータセット間のdomeain gapを回避するため、zero-shot learning方式を採用する。  
まず、反射の形状に基づいて360度画像から反射シーンの参照画像を探索し、それを用いて反射画像の忠実な色を復元するようにネットワークを誘導する。  
我々は、困難な反射アーチファクトが現れている30枚の360度テスト画像を収集し、提案手法が360度画像において既存の最先端手法を凌駕することを実証する。

# 1 Introduction
美術館やギャラリーのガラスショーケースを撮影するなど、ガラス越しの撮影はよくあります。  
ガラス越しに撮影された画像には、反射したシーンの望ましくないアーチファクトが現れます。  
このような映り込みは、ガラス越しの透過シーンの視認性を低下させ、多様なコンピュータビジョン技術の性能を低下させます。  
数十年前から、効率的な反射除去方法を開発する試みがなされてきた。  
既存の反射除去手法の多くは、制約のある環境下で撮影された複数のガラス画像を用いていたが、近年の学習ベースの手法は、入力された単一のガラス画像を透過画像と反射画像に分離する深層学習特徴量を利用することで優れた性能を達成している。
既存の手法はガラス前面のピンぼけシーンに関連するぼやけた反射アーチファクトを想定していますが、実際の反射アーチファクトは想定よりも多様な特性を示し、しばしば集約的でシャープになります。  
ゆえに、satate-of-the-artな学習ベースの手法であっても学習と実践の間のgapに苦しんでいる。  
特にVR用途に広く用いられている360度カメラは、特定の物体に焦点を合わせないため、Fig 1（a）に示すように、通常、ガラス領域上にくっきりした映り込みがある画像が生成されます。  
Fig 1（b）、（c）は、それぞれガラス領域と実際の反射シーンの参照領域を切り出した画像で、ガラス画像に反射シーンがはっきりと浮かび上がっていることが分かります。  
Fig 1 (d), (e) に示すように、360度画像の反射特性は通常の画像とは異なるため、既存の学習ベースの手法[16, 30]ではガラス画像からこのような映り込みを除去することができません。  
この場合、ガラス画像内のどのシーンが透過・反射しているかを人間でさえ区別することはとても困難になっています。  
しかし、360度画像内の反射シーンの視覚情報を参考にすることで、反射除去を効果的に誘導することができます。  

![Fig1](images/Fig1.png)  

360度画像に対する既存の唯一の反射除去法[9]は、教師あり学習のためのガラス画像を合成するアルゴリズムを用いるため、理論的には学習データとテストデータセットの間の領域ギャップに悩まされることになる。  
加えて、360度画像に対する反射除去の2つのタスクである画像復元と参照画像照合との連携に関係する部分はほとんどない。  
本論文では360度画像の反射除去のために、学習データセットを収集する負担の回避および、異なるデータセット間の領域ギャップを回避するzero-shot learningの枠組みを適用する。  
また、提案手法は、与えられたテスト画像に対する結果を交互に更新することで、画像復元と参照画像マッチングの両方の最適解を反復的に推定する。
まず、ガラス面の前に垂直に立てたカメラで360度画像を撮影し、360度画像の中心領域をガラス領域と見なすとする。  
そして、360度画像中の復元された反射画像との参照情報のマッチングを調べ、マッチングした参照情報に基づいてネットワークパラメータを更新し、透過画像と反射画像を復元します。  
その結果提案手法は、Fig 1(f)に示すように、360度画像における映り込みを除去する優れた性能を発揮します。  
本研究の主な貢献は、以下のようにまとめられます。

1. 我々の知る限り本論文は単一の360度画像に対する反射除去問題に対してゼロショット学習の枠組みを適用した最初の研究であり、既存の教師あり学習手法でみられる異なるデータセット間の領域ギャップを回避している。
2. 提案手法は、360度画像上の反射形状を利用して参照マッチングを洗練し、洗練された参照を手掛かりに透過画像と反射画像を適応的に復元する。 
3. 実験のために30枚のテスト用の実360度画像を収集し、提案手法が最先端の反射除去技術を凌駕することを実証する。

# 2 Related Works
本節では，既存の反射除去手法について簡単にまとめる．  
既存の手法を教師なしアプローチと教師ありアプローチに分類する。  
教師なしアプローチには、計算による反射除去法と、学習のためのペアデータセットを必要としない最新のゼロショット学習ベースの画像分解法が含まれる。  
一方、教師ありアプローチには学習ベースの単一画像反射除去法が含まれる。

**Unsupervised approach:**  
このような反射光アーチファクトは，特定の撮影環境下で撮影された複数の画像に現れる．  
[5, 13, 21]は，偏光角によって強度が変化する反射光の特性を利用し，複数の偏光画像の反射アーチファクトを除去している．  
また[20]では，焦点距離の異なる複数のガラス画像を2枚の画像に分離し，ボケ度を明確にしている．  
また，[7, 8, 17, 24, 29]は，カメラ位置を変えて撮影した複数のガラス画像について，透過シーンと反射シーンの異なる挙動を解析している．  
さらに、[19]は映像中の透過場面の繰り返し移動を検出している。  
また，[23]はブラックボックス映像から自動車のフロントガラスに映る静止画を抽出した．  
一方1枚のガラス画像から映り込みを除去することは、透過画像と反射画像を区別するための特性がないため困難である。  
[14]はユーザ支援により，ガラス画像上で除去すべき反射エッジを選択した．  
[18]は反射画像は透過画像よりも不鮮明であるという強い仮定のもと、入力画像を鮮明な層と不鮮明な層に分離し、透過画像と反射画像を取得した。  
また[15]では，ガラス画像は異なる2つのエッジ間の交差点が多くなると仮定し，交差点の総数が最小になるようにガラス画像を2つのレイヤーに分離している．  
[22]はガラス窓の表裏で反射した光がゴースト効果をもたらすため、空間的に繰り返される視覚構造を除去している。  
[6]は、透過シーンと反射シーンがそれぞれ動的と静的であるという制約のある環境下で撮影された複数のガラス画像を分解するネットワークを学習させる一般的なフレームワークを提案した。  
既存の手法では、複数のガラス画像を必要としたり、反射物の明確な特徴を想定したりしますが、提案手法では、単一の360度画像から参照情報を検出することにより、透過画像と同様の特徴を示す難しい反射物の除去を行います。  

**Supervised approach:**  
近年ディープラーニングを用いた反射除去法が提案されています。  
これらは，ガラス画像と透過画像のペアデータセットを用いてディープネットワークを学習させ，反射物特有の特性を強く仮定した計算機上での手法よりも信頼性の高い結果を提供する．  
[4]は反射除去に初めてCNNを適用し，2つのネットワークを直列に接続して，透過画像のグラデーションと色をそれぞれ復元する枠組みを提案した。  
[25]は透過画像の色と階調を同時に予測するフレームワークを修正した．  
また、[30]は、過去の結果を用いて再帰的に透過画像と反射画像を予測する新たなフレームワークを提案した。  
同様に[16]はガラス画像から透過画像と反射画像を予測するために、透過と反射の復元結果を事前にフィードバックして繰り返す完全カスケード型のフレームワークを採用した。  
[2]は映り込みが支配的な局所領域を示す確率マップを予測することで、局所的に集中する反射アーチファクトに対処した。  
一方，教師あり学習の学習データの問題に取り組んだ手法もある．  
[27]は、既存の学習データセットで頻繁に観測される、入力ガラス画像とその真正透過画像との間の不整合に関係なく、ネットワークパラメータを学習するための新しい損失項を定義している。  
実画像においてガラス画像と透過画像のペアデータがないため、[32]はガラス面への光線入射角度に依存する光吸収効果を含むガラス画像を合成するための高度な画像定式化をモデル化した。  
また，[12]は，グラフィカルシミュレータを用いて物理的に反射を模倣し，合成ガラス画像を生成している。  
また，[28]では，ガラス画像合成と同時に反射除去のためのディープネットワークを利用し，よりリアルなガラス画像を作成し，学習用に利用した．  
最近、[9]はパノラマ画像のガラス窓と反対方向に撮影した参照画像を用いて、反射アーチファクトを除去しています。
しかし、教師あり学習ベースの手法はすべてドメインギャップに悩まされている。  
[1]では既存手法の反射除去性能は、その学習データセットに含まれる反射アーチファクトの種類によって決定されることを示した。  
一方、提案手法はゼロショット学習の枠組みに基づき、与えられた入力画像に対して適応的に動作し、教師あり学習の枠組みにおける学習データセットの収集の負担を軽減することができる。

![Fig2](images/Fig2.png)  
Fig 2：オプティカルフロー推定器を用いた画像アライメント  
(a) 360度画像上の正面ガラス画像と参照画像のペア  
フローマップはと歪んだ参照画像はそれぞれ(b)DICL[26]よって、(c)FlowNet[3]によって得られたものである。

# 3 Methodology
360度画像はカメラの周囲の環境シーン全体を含むため、ガラスのシーンと関連する反射シーンが一緒に撮影されます。  
提案手法では、反射シーンを含む参照領域から関連する情報を持ってくることで、360度画像中のガラス領域に関連する透過画像と反射画像を復元する。  
本章では、まず360度画像中の反射形状に基づく参照画像の探索方法について説明します。  
次に、提案するゼロショット学習の枠組みを、既存手法であるDDIP[6]と簡単な比較を交えて紹介する。  
最後に提案手法のテスト時における詳細な学習過程を説明する。

## 3.1 Estimation of Reference Image
我々は、反射画像と関連する参照画像との関係を調査している。  
[9]で紹介したように、反射画像は測光歪みと幾何歪みに悩まされ、参照画像を用いてもガラス画像上の反射シーンと透過シーンを区別することが困難である。  
幾何学的な歪みは、ガラスの厚み、光の入射角、光の波長などの外的要因によって発生することがある。  
また、カメラに内蔵された画像信号処理（ISP）も、測光歪みの内部要因となっている。  
反射像と参照像の間の幾何学的歪みは、カメラからガラスや物体までの距離に依存する視差が主な原因である。  
最近のオプティカルフロー推定技術[3, 26]では、図2に示すように、反射画像と透過画像の混合による測光歪みのため、ガラス画像と参照画像の正しい対応関係を推定することができない。

![Fig3](images/Fig3.png)  
Fig 3：反射を利用した360度画像取得の構成。  
丸は360度映像のレンダリングを行う単位球の表面を表す。  

幾何学的歪みと写真的歪みの低減は鶏と卵の問題と考えることができる。  
反射画像とよく一致する参照画像は、反射されたシーンの内容を復元するための忠実な色を提供します。  
一方、反射画像の復元がうまくいけば、参照画像と反射画像の位置関係を合わせるための確かな視覚的特徴を得ることができます。  
提案手法は反射形状に基づき、ガラス画像領域内の各画素に対して信頼性の高い参照領域を求める。  
360度画像は3次元空間の物体から単位球の表面に投影される光線によって撮影される。  
特にガラス領域では、ガラスに反射した光線が追加で発生するため、そのような場合は距離情報がないため、3次元空間における正確な物体位置を推定することができない。  
Fig 3に示すように、360度画像のガラス領域で$x_i$に物体が観測された場合、ガラスが存在しなければ(仮に実態であれば)$\hat{x}$に物体が観測されることになる。  
反射形状に従い、ガラス面の向きで定義されるハウスホルダー行列[10]を用いて仮想点$\hat{x}_i$と$\hat{o}$の座標を算出する。  
物体は$d_i = \hat{x}_i -\hat{o}$の方向に沿って位置すると仮定し、仮想原点$\hat{o}$から物体までの距離を$d_i$に沿って変化させ、$x_i$に対する$c^k_i$の位置候補を検討する。  
そして、候補位置$c^{k'}_i$をそれぞれ単位面に投影してマッチング候補$x^{k'}_i$を集める。  
本研究ではガラスから遠い背景を扱うために、$d_i$の方向に沿ってサンプリングされた50 個の$c^k_i$の候補位置を含む探索空間を定義する。  
そして、探索空間の$x^{k'}_i$の中から、$x_i$との特徴量の差が最小となる$x_i$への最適なマッチング点$m_i$を求める。  
近傍画素を考慮し、$x_i$と$x^k_i$のパッチワイズ特徴差を次のように計算する。

$$
\Omega(x_i, x_i^k) = \frac{1}{|\mathcal{N}_i| + 1}\sum_{p_j\in \mathcal{N_i} \cup \{p_i\}} \parallel F_G(p_j) - F_R(p_j^k)\parallel_1 \tag{1}
$$

ここで、$F_G$と$F_R$はそれぞれ360度画像中のガラス領域と参照領域の任意の平行化特徴マップを表し、$p$は平行化画像領域上の$x$に対応する画素位置を表し、$\mathcal{N}_i$は$p_i$の近傍集合を表している。  
本研究では$\mathcal{N}_iの$大きさを$24$とする。  
具体的には、与えられた$x_i$に対して、色と勾配の特徴量の観点からそれぞれ最適な2つのマッチング点$m^c_i$と$m^g_iを$探索する。  
なお、学習反復回数$t$の表記は簡略化のため省略する。  
色に基づくマッチング点 $m^c_i$ を探索するために、$F_G$ を再構成された反射画像 $\hat{R}$ とし、$F_R$ を平行化された参照画像 $I_{ref}$ とする。  
$\hat{R}$と$m^c_i$は学習のために繰り返し更新され、より忠実な$\hat{R}$はより信頼性の高い$m^c_i$を提供し、逆もまた然りであることに注意されたい。  
勾配ベースのマッチング点$m^g_i$は、$F_G$と$F_R$に対して、それぞれ平行化されたガラス画像$I_G$と$I_{ref}$の勾配を用いることで得られる。  
$m^c_i$ と$m^g_i$ は反射像回復のために部分的に補完的な情報を提供することに注意されたい。  
$m^c_i$は、復元された反射画像が参照画像と見慣れない色を持つことを防ぐ一方で、$m^g_i$は、復元された反射画像がガラス画像の構造を保持するようにする。

![Fig4](images/Fig4.png)  
Fig 4：提案するネットワークの全体構成。  

## 3.2 Network Architecture
提案手法は、Fig 4に示すように、encoder、decoder、2つのgeneratorの4つのサブネットワークから構成される。  
透過画像と反射画像の復元でそれぞれネットワークパラメータ$\theta, \phi$を共有している。  
encoderは360度画像から平行画像を取得し、decoderが入力画像を再構成できるdeep特徴量を抽出する。  
ガラス画像のdeep特徴量は透過と反射の両方の特徴を持つため、generatorはガラス画像のdeep特徴量を透過特徴$h_T$と反射特徴$h_R$に分離するためのマスクマップを提供しそれぞれ次式で与えられる。

$$
\begin{align}
h_T = f_{\theta}(I_G)\cdot f_{\psi_T}(z_T), \tag{2}\\
h_R = f_{\theta}(I_G)\cdot f_{\psi_R}(z_R), \tag{3}
\end{align}
$$

ここで、$z_T$ と $z_R$ は異なるガウスランダムノイズを表し、$(\cdot)$ は要素ごとの乗算を表す。  
しかし、ガラス画像の光歪みにより反射画像の元の色を復元するための反射特徴が不完全なため、提案手法では反射特徴に適応的インスタンス正規化(AdaIN)［11］を適用し、不完全な情報を補う。  
反射特徴量$h_R$は、参照特徴量$h_{ref}$によって以下のように変換される。  

$$
\hat{h}_R = \sigma(h_{ref})(\frac{h_R - \mu(h_R)}{\sigma(h_R)}) + \mu(h_{ref}), \tag{4}
$$

ここで、$h_{ref} = f_{\theta}(I_{ref})$であり、$\mu$ と $\sigma$ は空間次元間の平均と標準偏差を計算するための演算を表す。  
提案手法は最終的に反射画像を$\hat{R} = f_{\phi}(\hat{h}_R)$として復号する。  
AdaINは空間位置をまたいだ統計量に従って特徴量を転送するため、反射画像と参照画像の幾何学的な差異を緩和することができる。  
反射回復とは異なり、透過の歪みは無視できると仮定し、$\hat{T} = f_{\phi}(h_T)$ を介して透過画像を予測する。  
DDIP[6]は、複数のガラス画像を透過画像と反射画像に分離できる一般的なフレームワークを導入しています。  
これは、ガラス画像合成のための線形定式化の下でネットワークを学習させるものである。  
しかし、最近の研究[1, 9, 28]では、このような素朴な定式化では実際のガラス画像をモデル化するには不十分であることが指摘されている。  
一方提案手法は、ガラス画像をdeep特徴量空間に分解し、得られた透過・反射カラーマップを単純に足し合わせるのではなく、透過・反射画像のdeep特徴量を統合してガラス画像を合成するものである。  
また、DDIPが単に複数のガラス画像を要求して透過シーンと反射シーンの特徴を区別するのに対し、提案手法は与えられた360度画像から反射画像と透過画像を区別するための参照情報をもたらす新しい枝を付加している点にも注目されます。  
ネットワークアーキテクチャの詳細については、補足資料をご参照ください。

# 3.3 Training Strategy
提案手法は与えられたインスタンスに対してテスト時にネットワークパラメータを学習する。  
特に提案するフレームワークの各ネットワークは、異なる学習損失に従ってそれぞれ学習される。  
各iterationにおいて、$(\theta, \phi)、\psi_R、\psi_T$は3つの個別のadam optimizerを用いて学習される。  
各テスト画像について、600iterationsにネットワークパラメータを更新する。  

**Encoderとdecoder:**  
encoderのパラメータ$\theta$とdecoderのパラメータ$\phi$は、以下のように定義されるソースマップ$X$とターゲットマップ$Y$の間の再構成Loss $\mathcal{L}_{recon}$に従い、入力画像自体を再構成するように学習される。

$$
\mathcal{L}_{recon}(X, Y) = \mathcal{L}_{mse}(X, Y) + \omega_1 \mathcal{L}_mse(\nabla X, \nabla Y) \tag{5}
$$

ここで、$\mathcal{L}_{mse}$は平均二乗誤差、$\omega_1$は学習用の勾配差の寄与度を決定するための重みを示す。  
学習用画像として、ガラス領域と参照領域の平行化画像$I_G, I_{ref}$を利用する。  
encoderは $I_G$ と $I_{ref}$ からdeep特徴量を抽出し、decoderは次式で定義されるオートエンコーダ損失 $\mathcal{L}_A$ を最小化する画像 $\hat{I}_G$ と $\hat{I}_{ref}$ を出力する。

$$
\mathcal{L}_A(\theta, \phi)=\mathcal{L}_{recon}(\hat{I}_G, I_G) + \mathcal{L}_{recon}(\hat{I}_{ref}, I_{ref}) \tag{6}
$$

任意の画像を用いて$\theta$と$\phi$を初期化すると、学習時間の短縮に役立つ。  
以下の実験ではすべて、[31]で示されている自然画像であらかじめ1エポック分学習させた$\theta$と$\phi$を用いた。  
**Mask generator for transmission recovery(透過画像復元のためのマスク生成器):**  
ネットワークパラメータ$\theta, \phi, \psi_T$は透過画像復元に関連するが、$\psi_T$は透過Lossによってのみ更新される。  
透過画像と反射画像が同じ画素位置に集中的な勾配を持つことはほとんどないという勾配事前分布は、反射除去にうまく利用されている。  
我々は、2つの画像が同じような位置に集中的な勾配を持たないように、この事前分布を拡張する。  
勾配事前損失$\mathcal{L}_{grad}$は次のように定義される。

$$
\mathcal{\hat{T}\hat{R}} = \frac{1}{N}\displaystyle \sum_{p_j} |\nabla \hat{T}||\nabla \hat{R}^*(p_i)|, \tag{7}
$$

ここで、$N$は画素の総数、$\nabla \hat{R}^*(p_i)$は$p_i$周辺で最大の大きさを持つ勾配、すなわち$\nabla \hat{R}^*(p_i) = \max_{p_j \in \mathcal{W}_i}|\nabla \hat{R}(p_j)|$ここで$\mathcal{W_i}$は$p_i$を中心とするローカルウィンドウ内の画素集合を示している。  
経験的に窓の大きさを$5$とした。また、復元された透過画像と反射画像を用いてガラス画像を合成することにより、ガラス画像の追加の再構成ロスを評価する。  
ガラス画像合成の場合、既存の手法[31, 30, 16]では、反射画像を手動で修正し反射の光歪みを模倣して、手作業で作成した画像形成モデルに従って合成している。  

一方、提案フレームワークはAdaINを無効化して歪んだ反射画像$\bar{R}$を$\bar{R} = f_\phi(f_\thetaθ(I_G) -f_{\psi_R}(z_R))$ として取得し、encoderとdecoderを用いてガラス画像を$\bar{I}_G = f_\phi(f_\theta(\hat{T}) + f_\theta(\bar{R}))$として合成する。  
伝送損失$\mathcal{L}_T$は次のように定義される。

$$
\mathcal{L}_T(\psi_T) = \mathcal{L}_{recon}(\tilde{I}_G, I_G) + \omega_2 \mathcal{L}_{grad}(\hat{T}, \hat{R}). \tag{8}
$$

**Mask generator for reflection recovery(反射画像復元のためのマスク生成器):**  
透過画像は勾配事前分布を適用し仮想的に推定されるが、反射画像は参照マッチング処理によって得られる参照カラーマップ$R$と参照勾配マップ$mathcal{M}$を持つ.  
つまり、$R(p_i)=I(m^c_i), \mathcal{M}(p_i)=\nabla I(m^g_i)$である。  
ここで$p_i$は平行面画像中の$x_i$に対応する画素位置を表している。  
反射損失の全体$\mathcal{L}_R$は次式で与えられる。

$$
\mathcal{L}_R(\psi_R) = \mathcal{L}_{recon}(\tilde{I}_G, I_G) + \omega_3\mathcal{L}_{mse}(\hat{R}, R) + \omega_4\mathcal{L}_{mse}(\nabla \hat{R}, \mathcal{M}). \tag{9}
$$

# 4 Experimental Results
本節では360度画像10枚に対する実験結果を示し，提案手法の各部の有効性を議論するとともに，提案手法と最先端手法の定性的・定量的な比較を行う．  
なお、本実験では、$\mathcal{L}_A$の$\omega_1$の重みを$1$、$\mathcal{L}_T$と$\mathcal{L}_R$の$\omega_1,\omega_2,\omega_3,\omega_4$の重みをそれぞれ$10, 3, 5, 50$に設定した。  
詳しい実験結果は補足結果をご覧ください。

![Fig5](images/Fig5.png)  
Fig 5：参照検索における特徴量マッチングの効果。  
(a) 360度画像から平行化したガラス画像と(b) 参照画像。  
提案手法では、（c）カラーベースマッチング、（d）勾配ベースマッチング、（e）その両方を用いて反射復元結果を得ている。

## 4.1 Ablation Study
**Feature matching for reference searching:**  
提案手法は、復元された反射画像の色とガラス画像の勾配を利用して、反射画像を復元するための情報をもたらすマッチングポイントを決定している。  
色に基づく照合点と勾配に基づく照合点のどちらかを利用して参照画像を探索する手法を比較検証した。 
Fig 5は、水族館の水槽の前で撮影した360度画像におけるガラス画像と参照画像を示したものである。  
Fig 5c、 Fig 5dに示すように、カラーベースマッチングのみを用いる方法では、反射したシーンの構造が破壊され、グラデーションベースマッチングのみを用いる方法では、反射画像の元の色を忠実に復元することができないことが分かります。  
しかし、両者のマッチングを併用することで、反射画像の構造を保持したまま、現実的な色を復元することが可能となりました。  
幾何学的な歪みにより、平行化された参照画像と復元された反射画像は位置がずれていることに注意してください。

**Glass synthesis loss:**  
勾配事前分布は画像分解のための良い洞察を与えますが、全てのピクセルが小さな勾配を持つ均質な画像になってしまう可能性があります。  
この問題は、ガラス合成Loss $\mathcal{L}_{recon}(\tilde{I}_G,I_G)$ を用いることで緩和することができる。  
Fig 6にガラス合成Lossの効果を示す。  
提案手法において $\mathcal{L}_{recon}(\tilde{I}_G,I_G)$ を用いない場合は、Fig 6bに示すように、透過画像と合成されたガラス画像からガラスの後ろのマネキンが消え、著しくぼやけた透過画像がえれられてしまう。  
これに対し、提案手法にて $\mathcal{L}_{recon}(\tilde{I}_G,I_G)$ を用いた場合は、合成されたガラス画像に、反射画像で検出されない画像コンテキストを強制的に与えることで、透過シーンのコンテキストを保持することが可能です。

![Fig6](images/Fig6.png)  
**Fig. 6: ガラス合成loss $\mathcal{L}_{recon}(\tilde{I}_G,I_G)$ の効果**  
(a) 360度画像から平行化したガラス画像と参照画像。  
以下、復元透過画像、反射画像、合成したガラス画像を提案手法で作成した3枚組
(b) $\mathcal{L}_{recon}(\tilde{I}_G,I_G)$ なし  
(c) $\mathcal{L}_{recon}(\tilde{I}_G,I_G)$ あり

**Gradient prior loss:**  
勾配事前loss $\mathcal{L}_{grad}$ のablation studyで、それが結果的に透過画像にどのような影響を与えるかを示す。  
Fig 7に示すように、勾配事前lossを用いない手法では、透過画像に強い映り込みによる鋭いエッジが残ることが多いのに対し、提案手法にて $\mathcal{L}_{grad}$を用いて学習した場合では、そのような反射エッジをうまく抑制している。  

![Fig7](images/Fig7.png)  
**Fig. 7: 勾配事前loss $\mathcal{L}_{grad}(\tilde{T}, \tilde{R})$ の効果**  
(a) 360度画像から平行化したガラス画像と参照画像。  
取得された透過画像と反射画像のペア  
(b) $mathcal{L}_{grad}(\tilde{T}, \tilde{R})$ なし  
(c) $mathcal{L}_{grad}(\tilde{T}, \tilde{R})$ あり  

## 4.2 Qualitative Comparison
単一の360度画像に対する教師なし反射除去の既存手法は存在しないため、提案手法を代表的な教師なし手法[18]および単一ガラス画像から反射アーチファクトを除去する最新の教師あり手法[12, 16, 30, 31]と比較した．  
既存手法の入力画像として、360度画像中のガラス領域の平行化画像を与えた。  
反射除去手法の多くは、透過画像だけでなく反射画像も復元するため、復元された透過画像と反射画像の品質を合わせて評価します。  
Fig. 8は、人間でも透過像と反射像の区別が難しい3つのガラス画像に対する反射除去の結果を示しています。  

![Fig8](images/Fig8.png)  
Fig. 8: 反射除去性能の定性的比較  
(a) 360度画像におけるガラス画像と参照画像のペア。  
(b) RS [18], (c) PRR [31], (d) BDN [30], (e) IBCLN [16], (f) PBTI [12], (g) 提案手法を用いて得られた透過・反射画像復元結果です。

正解画像がないため、360度画像中のずれた参照領域の平行化画像を推論して反射シーンを表示する。  
教師なし手法RS[18]は、ぼやけた反射アーチファクトを除去することを目標としているため、テストガラス画像上の映り込みをほとんど除去することができなかった。  
また，既存の学習ベースの手法は，PBTI[12]を除き，主に反射画像を手動でぼかし，減衰させた合成ガラス画像で学習するため，映り込みの検出に失敗している．  
PBTIはグラフィックシミュレータを用いてリアルなガラス画像を生成し、Fig 8の最初の画像に示すように空からの灰色で均一な反射アーチファクトを抑制しましたが、他のガラス画像におけるカラフルで構造的な映り込みを除去することができませんでした。  
一方提案手法は、360度画像から推定した参照領域を用いて、反射画像を推定し、困難な映り込みを抑制することに成功しました。

## 4.3 Quantitative Comparison
360度画像の中で映り込みの無いガラス画像を単純に合成するのである。  
実際には360度画像の中央部をガラス領域とし、ガラス領域と対向する領域の任意の深さを反射シーンとする。  
そして、従来の線形ガラス画像定式化に従って、ガラス領域内の透過画像を合成する。 
Table 1では、12枚の360°合成画像を用いて、反射除去手法の性能を定量的に比較しています。  
提案手法はSSIM-Tを除く全ての指標において、比較した手法の中で1位であることが分かります。  
しかし、何も処理をしていない入力ガラス画像そのものでは、SSIM-Tスコアが0.666となり、ほとんどの手法よりもずっと高い値を示していることに注意してください。  
これは、反射除去の実際の性能を反映するには定量的な指標では不十分であり、実際のテストデータセットでの定性的な比較の方がはるかに有益であることを意味します。

![Table1](images/Table1.png)  
Table 1: 反射除去の定量的性能の比較  

![Fig9](images/Fig9.png)  
Fig. 9: ガラス面の配向角度の違いによる層分離の結果  

## 4.4 Limitations
ガラス面の向きの角度偏差は、マッチング候補の3次元空間での位置ずれを大きくし、提案手法の性能を低下させる可能性がある。  
Fig 9はこの限界を示しており、ガラス面の向きの角度偏差が大きくなると、復元した透過画像にガラス領域での映り込みが多く残ってしまいます。  
また、提案手法は、カメラで撮影された参照画像の品質に大きく依存するため、カメラで反射した内容物自体を除去できず、参照画像が強い外乱光によって露光過多になると、透過画像や反射画像の復元に失敗することが多くなります。

# 5 Conclusion
本論文ではZero-Shot Learningを適用した360度画像に対する新規な反射除去手法を提案した。  
提案手法は、反射形状に基づき360度画像中のガラス領域の外側から信頼できる参照情報を探索する。  
そして、探索された参照情報に従って、透過画像と反射画像の本物らしい色を適応的に復元する。  
実験により提案手法は、360度画像に対して、既存のstate-of-the-artな手法と比較して、優れた反射除去結果を提供することが実証された。  

**Acknowledgements**  
本研究は、科学情報通信部(MSIT)内の韓国国立研究財団(Grant 2020R1A2B5B01002725)、および韓国政府による情報通信技術企画評価院(IITP)助成金(MSIT(NO.2021-0-202068、人工知能イノベーションハブ)およびo.2020-0-01336、人工知能大学院プログラム(UNIST))の支援を受けて行われたものです。